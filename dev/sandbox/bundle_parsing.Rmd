---
title: "UNcleR Bundle Parsing Sandbox"
output: github_document
knit: (function(input_file, ...) {
    rmarkdown::render(
      input=input_file,
      encoding="UTF-8",
      output_file = 'README.md'
    )
  })
---

```{r setup, include=FALSE}
# set chunk defaults for suppressing console message and displaying code by default
knitr::opts_chunk$set(
  message = FALSE,
  # warning = FALSE,
  echo = TRUE,
  include = TRUE
)
# set working directory for chunks and show progress bar for knitr actions
knitr::opts_knit$set(
  root.dir = "~/GitHub/UNcleR/",
  progress = TRUE
)


## data loading and manipulation
# library(feather)
library(tidyverse)
# library(magrittr) # for the Tee pipe
library(readxl)

## statistics
# library(rstatix)

## plotting
library(cowplot)
# library(ggrepel)
# library(ggridges)
# library(gganimate)
# library(lemon)
library(RColorBrewer)
library(xkcdcolors)
library(extrafont)

## programming
library(glue)
library(rlang)

## interactivity
# library(crosstalk)
# library(plotly)

# user packages
# library(fragr)
library(UNcleR)
# library(RTtools)

# default style for ggplot
theme_set(
  theme_bw(base_family = "Roboto Condensed") +
    theme(
      axis.text = element_text(face = "bold"),
      panel.grid = element_blank()
    )
)


# useful variables
wellOrder <- purrr::map2_chr(rep(c(LETTERS[1:8]), 12), purrr::flatten_chr(purrr::map(c(1:12), rep, 8)), paste0)
uniOrder <- purrr::map2_chr(rep(c(LETTERS[1:16]), 3), purrr::flatten_chr(purrr::map(c(1:3), rep, 16)), paste0)
```


## Parsing Bundled Export Spectra Files

```{r}
SLSpath <- "testing/Seq_Cas9/Exports/pH Screen/bundled_spectra/210602-01-Seq1 Cas9-pH003R-SLS Bundle.uni-2021-06-03T09-36-29.xlsx"

SLSbundle_sheets <- readxl::excel_sheets(SLSpath) |> {\(x) x[match(x[x != "Sheet1"], uniOrder)]}() |> purrr::set_names()
# SLSbundle_sheets

SLSbundle <- purrr::map_dfr(SLSbundle_sheets, readxl::read_xlsx, path = SLSpath, skip = 3, .id = "uni") |> 
  tidyr::nest(FLUORspec = c(2:3), SLSspec266 = c(4:5), SLSspec473 = c(6:7)) |> 
  mutate(across(contains("spec"),
           \(lcol) purrr::map(lcol, \(df) rename_with(df, .cols = 1, .fn = ~ "temp_C"))
           )
         )
SLSbundle
```

